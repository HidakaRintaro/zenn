---
title: "GAS + clasp + TypeScript + GitHub Actions ã®ç’°å¢ƒæ§‹ç¯‰"
emoji: "ğŸ› ï¸"
type: "tech" 
topics: [gas, clasp, githubactions]
published: true 
---

å®šæœŸçš„ã«GASã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ãŒã€æ¯åº¦`clasp`ã‚„`TypeScript`ã§ç’°å¢ƒæ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’å¿˜ã‚Œã‚‹ãŸã‚è‡ªåˆ†ã®ãŸã‚ã«ã‚‚è¨˜äº‹ã«ã—ã¦ãŠãã€‚

https://github.com/HidakaRintaro/gas-clasp-ts-gha-template

## å®Ÿè¡Œç’°å¢ƒ
```
node: 20.11.1 
yarn: 1.22.19 
clasp: 2.4.2
```

## ç’°å¢ƒæ§‹ç¯‰
ä¸‹è¨˜ã‹ã‚‰ Google Apps Script API ã‚’ONã«ã™ã‚‹ã€‚
[https://script.google.com/home/usersettings](https://script.google.com/home/usersettings)
![GAS APIã‚’ONã«ã™ã‚‹GIFç”»åƒ](/images/1e67ec6a4ed91d/gas-api-on.gif)

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
$ yarn init -y
$ yarn add -D @google/clasp typescript @types/google-apps-script
$ yarn add -D eslint prettier @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint-config-prettier
```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«é¡ã®è¨­å®š
```bash
$ yarn tsc --init
$ touch eslint.config.js 
$ touch .prettierrc.yaml
```

### Googleã¸ã®ãƒ­ã‚°ã‚¤ãƒ³
```bash
$ yarn clasp login 
```

### æ–°è¦ä½œæˆ
```bash
$ yarn clasp create
```

### æº–å‚™
```bash
$ mkdir src
$ touch src/index.ts
$ mv appsscript.json src
```

```diff: .clasp.json
{
  "scriptId": "<ã‚¹ã‚¯ãƒªãƒ—ãƒˆID>",
- "rootDir": "<ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª>"
+ "rootDir": "./src"
}
```

```diff: src/appsscript.json
{
- "timeZone": "America/New_York",
+ "timeZone": "Asia/Tokyo",
  "dependencies": {
  },
  "runtimeVersion": "V8"
}
```

### GASã‚’æ›¸ã„ã¦ã„ã
pushãŒã§ãã‚‹ã‹ã®ç¢ºèªã®ãŸã‚å°‘ã—ã ã‘è¨˜è¿°
```ts: src/index.ts
function outputHello(): void {
  console.log(`Hello World`);
}
```

## ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
$ yarn clasp push

# openã§é–‹ã„ãŸGASã®ã‚¨ãƒ‡ã‚£ã‚¿ã« `index.gs` ãŒã‚ã‚Œã°OKï¼
$ yarn clasp open
```

## GitHub Actionsã§ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
mkdir -p .github/workflows
touch .github/workflows/push-gas.yaml
```

GitHubã®Secretsã¸ä¸‹è¨˜ã‚’ç™»éŒ²ã™ã‚‹
- ACCESS_TOKEN
- ID_TOKEN
- EXPIRY_DATE
- REFRESH_TOKEN
- CLIENT_ID 
- CLIENT_SECRET

```yaml: .github/workflows/push-gas.yaml
name: push-gas

on:
  push:
    branches:
      - main
    paths:
      - "src/**"
      - ".github/workflows/push-gas.yaml"

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: "package.json"
          cache: "yarn"

      - name: Install packages
        run: |
          yarn install

      - name: Create .clasprc.json
        run: |
          cat << EOS > ~/.clasprc.json
          {
            "token": {
              "access_token": "${{ secrets.ACCESS_TOKEN }}",
              "refresh_token": "${{ secrets.REFRESH_TOKEN }}",
              "scope": "https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/logging.read https://www.googleapis.com/auth/script.deployments https://www.googleapis.com/auth/service.management https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/drive.metadata.readonly https://www.googleapis.com/auth/script.projects https://www.googleapis.com/auth/script.webapp.deploy openid https://www.googleapis.com/auth/userinfo.email",
              "token_type": "Bearer",
              "id_token": "${{ secrets.ID_TOKEN }}",
              "expiry_date": "${{ secrets.EXPIRY_DATE }}"
            },
            "oauth2ClientSettings": {
              "clientId": "${{ secrets.CLIENT_ID }}",
              "clientSecret": "${{ secrets.CLIENT_SECRET }}",
              "redirectUri": "http://localhost"
            },
            "isLocalCreds": false
          }
          EOS

      - name: Create .clasp.json
        run: |
          cat << EOS > ./.clasp.json
          {
            "scriptId": "${{ secrets.SCRIPT_ID }}",
            "rootDir": "src"
          }
          EOS

      - name: Push to Google Apps Script
        run: yarn clasp push -f

```

## ãã®ä»–
eslintã‚„prettierã€tsconfigã‚‚æœ€ä½é™ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ãã‚‹ã¨ã„ã„ãª...

## å‚è€ƒ
https://zenn.dev/babel/articles/eslint-flat-config-for-babel
https://dev.classmethod.jp/articles/github-actions-gas-deploy/